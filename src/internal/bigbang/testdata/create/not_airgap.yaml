apiVersion: zarf.dev/v1alpha1
kind: ZarfPackageConfig
metadata:
  name: bigbang
  yolo: true
components:
- name: flux
  required: true
  manifests:
  - name: flux-system
    namespace: flux-system
    files:
    - flux/bb-flux.yaml
- name: bigbang
  required: true
  manifests:
  - name: bigbang
    namespace: bigbang
    files:
    - manifests/bb-gitrepository.yaml
    - manifests/bb-helmrelease.yaml
  actions:
    onRemove:
      before:
      - cmd: ./zarf tools kubectl patch helmrelease -n bigbang bigbang --type=merge -p '{"spec":{"suspend":true}}'
        description: Suspend Big Bang HelmReleases to prevent reconciliation during removal.
  healthChecks:
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: grafana
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: istio
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: istio-operator
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: kiali
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: kyverno
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: kyverno-policies
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: kyverno-reporter
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: loki
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: monitoring
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: neuvector
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: promtail
  - apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    namespace: bigbang
    name: tempo
